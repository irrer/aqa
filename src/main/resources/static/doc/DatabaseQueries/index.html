<div title="Database Queries" class="col-md-10 col-md-offset-1">
    <!--
    Copyright 2021 Regents of the University of Michigan

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
    -->

    <h2>@@title@@</h2>

    <p>
        The AQA software uses an SQL database. This user guide provides sample queries to simplify users' experience. If
        you need a query that is not listed, please contact the site administrator.
    </p>
    <p>
        To perform these queries a database account is required, which is different from the account used to access the
        web. To obtain a database account, contact the site administrator. Note that database accounts provide read-only
        access to the database to protect against accidental modification of data.
    </p>
    <p>
        Examples include the <b>LIMIT 10</b> statement which limits the number of rows returned to 10 to make it more
        appropriate while becoming familiar with the data. Remove or change this to get more data.
    </p>
    <p>
        The AQA software is compatible with both PostgreSQL and Microsoft SQL server databases. The Automated Quality
        Assurance site uses PostgreSQL version 12.5 R5.
    </p>
    <p>
        Refer to the <a href="https://www.postgresql.org/docs/12/sql-select.html"> PostgreSQL documentation</a> for more
        information.
    </p>


    <h3>Index</h3>
    <ul>
        <li><a href="SymmetryFlatnessConstancy.html">Symmetry Flatness Constancy</a></li>
        <li><a href="LeafPosition.html">Leaf Position / Picket Fence</a></li>
        <li><a href="CollimatorCentering.html">Collimator Centering</a></li>

        <li><a href="#Filler">Dummy</a></li>

        <li><a href="#Filler">Dummy</a></li>

        <li><a href="#SymmetryFlatnessConstancy">Symmetry Flatness Constancy</a></li>
        <li><a href="#CollimatorCentering">Collimator Centering</a></li>
        <li><a href="#CenterDose">Center Dose</a></li>
        <li><a href="#Wedge">Wedge</a></li>
        <li><a href="#CollimatorPosition">Collimator Position</a></li>
        <li><a href="#LeafPosition">Leaf Position</a></li>
        <li><a href="#VMAT">VMAT</a></li>
    </ul>

    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

    <hr/>

    <h3>Restricting Queries</h3>
    <p>
        Below are <b>WHERE</b> clauses that can be added to queries to focus on data of interest. It may also be
        desirable to limit the size of data returned by queries for efficient use of resources.
    </p>


    <h4 style="margin-top: 40px;">Restrict results to data created after a given date</h4>
    <pre>
        &nbsp;
        AND "output.dataDate" > '2019-10-25 16:00:00.00'
    </pre>

    <h4 style="margin-top: 40px;">Restrict results to a single machine</h4>
    <pre>
        &nbsp;
        AND "machine"."id" = 'MACH_5'
    </pre>

    <h4 style="margin-top: 40px;">Restrict results to a single institution</h4>
    <pre>
        &nbsp;
        AND "machine"."id" = 'INST_8'
    </pre>

    <h4 style="margin-top: 40px;">Limit the number of results to 10, starting at the 40th qualifying entry by adding
        this to the end of a query</h4>
    <pre>
        &nbsp;
        LIMIT 10 OFFSET 40;
    </pre>


    <h3 style="margin-top: 40px;">Database Schema</h3>

    <p>The database tables can be listed with:</p>
    <pre>
        &nbsp;
        SELECT *
          FROM pg_catalog.pg_tables
          WHERE schemaname != 'pg_catalog' AND
              schemaname != 'information_schema';
    </pre>


    <p style="margin-top: 40px;">The columns for a database table can be listed with:</p>
    <pre>
        &nbsp;
        SELECT
          table_name,
          column_name,
          data_type
        FROM
          information_schema.columns
        WHERE
          table_name = 'leafPosition';  -- where 'leafPosition' is the name of the table
    </pre>


    <h3 style="margin-top: 40px;">Database Conventions</h3>

    <p>All tables use a <a href="https://en.wikipedia.org/wiki/Surrogate_key">synthetic key</a> (also called a surrogate
        key) as their primary database key. The primary key name is the same as the table name, appended with 'PK'.
        For example, the primary key of the <b>collimatorCentering</b> table is <b>collimatorCenteringPK</b>. The same
        name is used when it is referenced as a foreign key.</p>
    <p>
        To indicate units, column names are appended with <b>_units</b>. For example,
        <b>"leafPosition"."offset_mm"</b> indicates a value in millimeters.
    </p>

    <hr/>
    <hr/>
    <hr/>
    <hr/>
    <hr/>
    <hr/>
    <hr/>
    <hr/>
    <hr/>
    <hr/>
    <hr/>
    <hr/>
    <hr/>
    <hr/>
    <hr/>
    <hr/>



    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

    <hr/>
    <h3 id="CollimatorCentering"><u>Collimator Centering</u></h3>
    <p>
        Refer to the <a href="../CollimatorCentering/index.html">Collimator Centering</a> user guide for more
        information.
    </p>
    <pre>
        &nbsp;
        SELECT
          "institution"."name",
          "machine"."id",
          "machineType"."model",
          "multileafCollimator"."model",
          "output"."dataDate",
          "collimatorCentering"."xCollimatorCenter_mm",
          "collimatorCentering"."yCollimatorCenter_mm",
          "collimatorCentering"."X1_090_mm",
          "collimatorCentering"."X2_090_mm",
          "collimatorCentering"."Y1_090_mm",
          "collimatorCentering"."Y2_090_mm",
          "collimatorCentering"."X1_270_mm",
          "collimatorCentering"."X2_270_mm",
          "collimatorCentering"."Y1_270_mm",
          "collimatorCentering"."Y2_270_mm"
        FROM
          public."collimatorCentering",
          public."institution",
          public."machine",
          public."machineType",
          public."multileafCollimator",
          public."output"
        WHERE
              ("collimatorCentering"."outputPK" = "output"."outputPK")
          AND ("output"."machinePK" = "machine"."machinePK")
          AND ("machine"."institutionPK" = "institution"."institutionPK")
          AND ("machine"."machineTypePK" = "machineType"."machineTypePK")
          AND ("machine"."multileafCollimatorPK" = "multileafCollimator"."multileafCollimatorPK")
        ORDER BY
          "machine"."id",
          "output"."dataDate"
        ASC LIMIT 10;
    </pre>

    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

    <hr/>
    <h3 id="CenterDose"><u>Center Dose</u></h3>
    <p>
        Refer to the <a href="../CenterDose/index.html">Center Dose</a> user guide for more
        information.
    </p>
    <pre>
        &nbsp;
        SELECT
          "institution"."name",
          "machine"."id",
          "machineType"."model",
          "multileafCollimator"."model",
          "output"."dataDate",
          "centerDose"."beamName",
          "centerDose"."dose"
        FROM
          public."centerDose",
          public."institution",
          public."machine",
          public."machineType",
          public."multileafCollimator",
          public."output"
        WHERE
              ("centerDose"."outputPK" = "output"."outputPK")
          AND ("output"."machinePK" = "machine"."machinePK")
          AND ("machine"."institutionPK" = "institution"."institutionPK")
          AND ("machine"."machineTypePK" = "machineType"."machineTypePK")
          AND ("machine"."multileafCollimatorPK" = "multileafCollimator"."multileafCollimatorPK")
        ORDER BY
          "machine"."id",
          "output"."dataDate"
        ASC LIMIT 10;
    </pre>

    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

    <hr/>
    <h3 id="Wedge"><u>Wedge</u></h3>
    <p>
    </p>
    <pre>
        &nbsp;
          SELECT
          "institution"."name",
          "machine"."id",
          "machineType"."model",
          "multileafCollimator"."model",
          "output"."dataDate",
          "wedgePoint"."wedgeBeamName",
          "wedgePoint"."backgroundBeamName",
          "wedgePoint"."wedgeValue_cu",
          "wedgePoint"."backgroundValue_cu",
          "wedgePoint"."percentOfBackground_pct",
          "wedgePoint"."isBaseline"
		FROM
          public."wedgePoint",
          public."institution",
          public."machine",
          public."machineType",
          public."multileafCollimator",
          public."output"
        WHERE
              ("wedgePoint"."outputPK" = "output"."outputPK")
          AND ("output"."machinePK" = "machine"."machinePK")
          AND ("machine"."institutionPK" = "institution"."institutionPK")
          AND ("machine"."machineTypePK" = "machineType"."machineTypePK")
          AND ("machine"."multileafCollimatorPK" = "multileafCollimator"."multileafCollimatorPK")
        ORDER BY
          "machine"."id",
          "output"."dataDate"
        ASC LIMIT 10;
    </pre>

    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

    <hr/>
    <h3 id="CollimatorPosition"><u>Collimator Position</u></h3>
    <p>
    </p>
    <pre>
        &nbsp;
        SELECT
          "institution"."name",
          "machine"."id",
          "machineType"."model",
          "multileafCollimator"."model",
          "output"."dataDate",
          "collimatorPosition"."beamName",
          "collimatorPosition"."X1_mm",
          "collimatorPosition"."X2_mm",
          "collimatorPosition"."Y1_mm",
          "collimatorPosition"."Y2_mm",
          "collimatorPosition"."X1_ExpectedMinusImage_mm",
          "collimatorPosition"."X2_ExpectedMinusImage_mm",
          "collimatorPosition"."Y1_ExpectedMinusImage_mm",
          "collimatorPosition"."Y2_ExpectedMinusImage_mm",
          "collimatorPosition"."gantryAngle_deg",
          "collimatorPosition"."collimatorAngle_deg",
          "collimatorPosition"."FloodCompensation", -- true if flood compensation was used
          "collimatorPosition"."XCollimatorCenterOfRotation_mm",
          "collimatorPosition"."YCollimatorCenterOfRotation_mm"
		FROM
          public."collimatorPosition",
          public."institution",
          public."machine",
          public."machineType",
          public."multileafCollimator",
          public."output"
        WHERE
              ("collimatorPosition"."outputPK" = "output"."outputPK")
          AND ("output"."machinePK" = "machine"."machinePK")
          AND ("machine"."institutionPK" = "institution"."institutionPK")
          AND ("machine"."machineTypePK" = "machineType"."machineTypePK")
          AND ("machine"."multileafCollimatorPK" = "multileafCollimator"."multileafCollimatorPK")
        ORDER BY
          "machine"."id",
          "output"."dataDate"
        ASC LIMIT 10;
    </pre>

    <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

    <p style="margin-bottom: 80px;"></p>

</div>
