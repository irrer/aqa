<div title="DICOM Metadata Specifics">
    <!--
    Copyright 2024 Regents of the University of Michigan

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
    -->

    <h2>@@title@@</h2>

    <p>
        This document provides details as to how DICOM metadata (attributes) from the image file and the template file
        are combined to create a new DICOM file. An image / template pair must be provided for each file in the series
        to
        be created. More specifically:
    </p>

    <ul>
        <li>
            <b>Image File</b> A DICOM RTIMAGE file delivered either in dev or production mode. This is the source of the
            image pixels.
        </li>
        <li>
            <b>Template File</b> A DICOM RTIMAGE file delivered dev production mode. This is the source of the beam
            information.
        </li>
    </ul>


    <h3>Overview of attribute use:</h3>

    <ul>
        <li>The image pixels and image properties (rows, resolution, scaling, etc.) are copied from the source image.
        </li>
        <li>Some UIDs (Unique IDs) are newly created, others are copied from the template files.</li>
        <li>Most dates and times are set to the <em>ContentDate</em> and <em>ContentTime</em> in the image file, some
            are from the template file.
        </li>
        <li>Some values are set by the user via the web interface (e.g. <em>PatientID</em>,
            <em>RadiationMachineName</em>).
        </li>
        <li>
            Beam defining attributes (e.g. KVP, GantryAngle) are copied from the template file. Several of these values
            are used by the AQA analysis to determine how to process the beam. Overriding them forces the software to
            treat them as it would the beam by that name.
        </li>
        <li>
            Attributes not specifically listed here are copied from the template file.
        </li>
    </ul>

    Sections:

    <p style="margin-left:50px;">
        <a href="#misc"> Miscellaneous Attributes </a>
        <br/>
        <a href="#uid"> UIDs </a>
        <br/>
        <a href="#datetime"> Date and Time </a>
        <br/>
        <a href="#user"> Set by User </a>
        <br/>
        <a href="#image"> Copied from Image </a>
        <br/>
        <a href="#template"> Copied from template </a>
    </p>

    <h3 id="misc">Miscellaneous Attributes</h3>
    <p>
        The following attributes are set up with special processing.
    </p>

    <table class="table table-bordered" style="text-align:left;width: 100%;">
        <tr>
            <th>Hex Tag</th>
            <th>Attribute Name</th>
            <th>Value Setup</th>
        </tr>
        <tr>
            <td>3002,0012</td>
            <td>RTImagePosition</td>
            <td> Calculated from values in the image <em>3002,0011 </em>:<em>ImagePlanePixelSpacing</em> <em>
                0028,0010 </em>:<em>Rows</em> and <em>0028,0011 </em>:<em>Columns</em></td>
        </tr>

        <tr>
            <td>300c,0002</td>
            <td>ReferencedRTPlanSequence</td>
            <td>Constructed using specified plan</td>
        </tr>

        <tr>
            <td>0008,0080</td>
            <td>InstitutionName</td>
            <td>Copied from image files not available for dev files</td>
        </tr>
    </table>

    <h3 id="uid">Unique IDs</h3>
    <p>
        List of UIDs that are set up.
    </p>

    <table class="table table-bordered" style="text-align:left;width: 100%;">
        <tr>
            <th>Hex Tag</th>
            <th>Attribute Name</th>
            <th>Value Setup</th>
        </tr>
        <tr>
            <td>0002,0003</td>
            <td>MediaStorageSOPInstanceUID</td>
            <td>Set to new unique ID</td>
        </tr>
        <tr>
            <td>0008,0018</td>
            <td>SOPInstanceUID</td>
            <td> Set to same as <em>MediaStorageSOPInstanceUID</em></td>
        </tr>
        <tr>
            <td>0020,000d</td>
            <td>StudyInstanceUID</td>
            <td>Copied from template file</td>
        </tr>
        <tr>
            <td>0020,000e</td>
            <td>SeriesInstanceUID</td>
            <td> Set to new unique ID Same for each image in series</td>
        </tr>
        <tr>
            <td>0020,0052</td>
            <td>FrameOfReferenceUID</td>
            <td>Set to new unique ID Different for each image</td>
        </tr>

    </table>

    <h3 id="datetime">Dates and Times</h3>
    <p>
        Set up of dates and times. Note that in dev files, the only date/time value that are present are the
        <em>ContentDate</em> and <em>ContentTime</em> values.
    </p>
    <table class="table table-bordered" style="text-align:left;width: 100%;">
        <tr>
            <th>Hex Tag</th>
            <th>Attribute Name</th>
            <th>Value Setup</th>
        </tr>
        <tr>
            <td>0008,0020</td>
            <td>StudyDate</td>
            <td> Set to <em>StudyDate</em> of earliest production (non dev) image</td>
        </tr>
        <tr>
            <td>0008,0030</td>
            <td>StudyTime</td>
            <td> Set to <em>StudyTime</em> of earliest production (non dev) image</td>
        </tr>
        <tr>
            <td>0008,0021</td>
            <td>SeriesDate</td>
            <td><em>ContentDate</em> of first image beam</td>
        </tr>
        <tr>
            <td>0008,0031</td>
            <td>SeriesTime</td>
            <td><em>ContentTime</em> of first image beam</td>
        </tr>
        <tr>
            <td>0008,0022</td>
            <td>AcquisitionDate</td>
            <td> Set to image <em>ContentDate</em></td>
        </tr>
        <tr>
            <td>0008,0032</td>
            <td>AcquisitionTime</td>
            <td>Set to image <em>ContentTime</em></td>
        </tr>
        <tr>
            <td>0008,0012</td>
            <td>InstanceCreationDate</td>
            <td> set to same as <em>ContentDate</em></td>
        </tr>
        <tr>
            <td>0008,0013</td>
            <td>InstanceCreationTime</td>
            <td>set to same as <em>ContentTime</em></td>
        </tr>

    </table>

    <h3 id="user">Values Set By User</h3>
    <p>
        These values are directly or indirectly controlled by the user via the web interface.
    </p>

    <table class="table table-bordered" style="text-align:left;width: 100%;">
        <tr>
            <th>Hex Tag</th>
            <th>Attribute Name</th>
            <th>Value Setup</th>
        </tr>

        <tr>
            <td>0008,1010</td>
            <td>StationName</td>
            <td> Set to same as <em>RadiationMachineName</em></td>
        </tr>

        <tr>
            <td>0010,0010</td>
            <td>PatientName</td>
            <td> Set by user Defaults to value found in uploaded RTIMAGE files If not defined there defaults to value in
                plan
            </td>
        </tr>

        <tr>
            <td>0010,0020</td>
            <td>PatientID</td>
            <td>Set by user Defaults to value found in uploaded RTIMAGE files If not defined there defaults to value in
                plan
            </td>
        </tr>

        <tr>
            <td>0018,1000</td>
            <td>DeviceSerialNumber</td>
            <td> Set by user when choosing machine</td>
        </tr>

        <tr>
            <td>3002,0020</td>
            <td>RadiationMachineName</td>
            <td>Set by user when choosing machine</td>
        </tr>

    </table>


    <h3 id="image">Values Copied from Image</h3>
    <p>
        The following DICOM attributes are copied from the source image file to the new file.
    </p>
    <table class="table table-bordered" style="text-align:left;">
        <tr>
            <th>Hex Tag</th>
            <th>Attribute Name</th>
        </tr>
        <tr>
            <td>Hex Tag</td>
            <td>Name</td>
        </tr>
        <tr>
            <td>0008,0023</td>
            <td>ContentDate</td>
        </tr>
        <tr>
            <td>0008,0033</td>
            <td>ContentTime</td>
        </tr>
        <tr>
            <td>0020,4000</td>
            <td>ImageComments</td>
        </tr>
        <tr>
            <td>0028,0002</td>
            <td>SamplesPerPixel</td>
        </tr>
        <tr>
            <td>0028,0004</td>
            <td>PhotometricInterpretation</td>
        </tr>
        <tr>
            <td>0028,0010</td>
            <td>Rows</td>
        </tr>
        <tr>
            <td>0028,0011</td>
            <td>Columns</td>
        </tr>
        <tr>
            <td>0028,0100</td>
            <td>BitsAllocated</td>
        </tr>
        <tr>
            <td>0028,0101</td>
            <td>BitsStored</td>
        </tr>
        <tr>
            <td>0028,0102</td>
            <td>HighBit</td>
        </tr>
        <tr>
            <td>0028,0103</td>
            <td>PixelRepresentation</td>
        </tr>
        <tr>
            <td>0028,1050</td>
            <td>WindowCenter</td>
        </tr>
        <tr>
            <td>0028,1051</td>
            <td>WindowWidth</td>
        </tr>
        <tr>
            <td>0028,1052</td>
            <td>RescaleIntercept</td>
        </tr>
        <tr>
            <td>0028,1053</td>
            <td>RescaleSlope</td>
        </tr>
        <tr>
            <td>0028,1054</td>
            <td>RescaleType</td>
        </tr>
        <tr>
            <td>3002,0002</td>
            <td>RTImageLabel</td>
        </tr>
        <tr>
            <td>3002,0003</td>
            <td>RTImageName</td>
        </tr>
        <tr>
            <td>3002,0004</td>
            <td>RTImageDescription</td>
        </tr>
        <tr>
            <td>3002,000a</td>
            <td>ReportedValuesOrigin</td>
        </tr>
        <tr>
            <td>3002,000c</td>
            <td>RTImagePlane</td>
        </tr>
        <tr>
            <td>3002,000d</td>
            <td>XRayImageReceptorTranslation</td>
        </tr>
        <tr>
            <td>3002,000e</td>
            <td>XRayImageReceptorAngle</td>
        </tr>
        <tr>
            <td>3002,0011</td>
            <td>ImagePlanePixelSpacing</td>
        </tr>
        <tr>
            <td>3002,0022</td>
            <td>RadiationMachineSAD</td>
        </tr>
        <tr>
            <td>3002,0026</td>
            <td>RTImageSID</td>
        </tr>
        <tr>
            <td>7fe0,0010</td>
            <td>PixelData</td>
        </tr>
    </table>

    <h3 id="template">Values from Template</h3>
    <p>
        The following DICOM attributes are copied from the template DICOM (the one delivered in production mode).
    </p>
    <table class="table table-bordered" style="text-align:left;">
        <tr>
            <th>Hex Tag</th>
            <th>Attribute Name</th>
        </tr>
        <tr>
            <td>3002,0029</td>
            <td>FractionNumber</td>
        </tr>
        <tr>
            <td>0008,1160</td>
            <td>ReferencedFrameNumber</td>
        </tr>
        <tr>
            <td>0018,0060</td>
            <td>KVP</td>
        </tr>
        <tr>
            <td>3002,0032</td>
            <td>MetersetExposure</td>
        </tr>
        <tr>
            <td>300A,00B6</td>
            <td>BeamLimitingDeviceSequence</td>
        </tr>
        <tr>
            <td>300A,00B8</td>
            <td>RTBeamLimitingDeviceType</td>
        </tr>
        <tr>
            <td>300A,00BC</td>
            <td>NumberOfLeafJawPairs</td>
        </tr>
        <tr>
            <td>300A,011C</td>
            <td>LeafJawPositions</td>
        </tr>
        <tr>
            <td>300A,00B8</td>
            <td>RTBeamLimitingDeviceType</td>
        </tr>
        <tr>
            <td>300A,00BC</td>
            <td>NumberOfLeafJawPairs</td>
        </tr>
        <tr>
            <td>300A,011C</td>
            <td>LeafJawPositions</td>
        </tr>
        <tr>
            <td>300A,00F0</td>
            <td>NumberOfBlocks</td>
        </tr>
        <tr>
            <td>300A,011E</td>
            <td>GantryAngle</td>
        </tr>
        <tr>
            <td>300A,0120</td>
            <td>BeamLimitingDeviceAngle</td>
        </tr>
        <tr>
            <td>300A,0122</td>
            <td>PatientSupportAngle</td>
        </tr>
        <tr>
            <td>300A,0128</td>
            <td>TableTopVerticalPosition</td>
        </tr>
        <tr>
            <td>300A,0129</td>
            <td>TableTopLongitudinalPosition</td>
        </tr>
        <tr>
            <td>300A,012A</td>
            <td>TableTopLateralPosition</td>
        </tr>
        <tr>
            <td>300A,00B3</td>
            <td>PrimaryDosimeterUnit</td>
        </tr>
        <tr>
            <td>300A,011E</td>
            <td>GantryAngle</td>
        </tr>
        <tr>
            <td>300A,0120</td>
            <td>BeamLimitingDeviceAngle</td>
        </tr>
        <tr>
            <td>300A,0122</td>
            <td>PatientSupportAngle</td>
        </tr>
        <tr>
            <td>300A,0128</td>
            <td>TableTopVerticalPosition</td>
        </tr>
        <tr>
            <td>300A,0129</td>
            <td>TableTopLongitudinalPosition</td>
        </tr>
        <tr>
            <td>300A,012A</td>
            <td>TableTopLateralPosition</td>
        </tr>
        <tr>
            <td>300A,012C</td>
            <td>IsocenterPosition</td>
        </tr>
        <tr>
            <td>300C,0006</td>
            <td>ReferencedBeamNumber</td>
        </tr>
        <tr>
            <td>300C,0022</td>
            <td>ReferencedFractionGroupNumber</td>
        </tr>
        <tr>
            <td>3273,0010</td>
            <td>VarianCreator3273</td>
        </tr>
        <tr>
            <td>3273,1000</td>
            <td>RTImageIsocenterPosition</td>
        </tr>
        <tr>
            <td>3273,1001</td>
            <td>RTImagePatientPosition</td>
        </tr>
    </table>


    <!-- ======================================= -->

    <!-- End of page spacer. -->
    <p style="margin:200px;">

    </p>


    <!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
    <!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->

</div>
