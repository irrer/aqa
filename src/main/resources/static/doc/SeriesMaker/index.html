<div title="Series Maker">
    <!--
    Copyright 2024 Regents of the University of Michigan

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
    -->

    <h2>@@title@@</h2>

    <p>
        Treatment machine dev (development) mode allows greater latitude in setting machine parameters. However, RTIMAGE
        files
        captured in dev mode lack some metadata (such as references to a plan, plan beam, and identity of the
        treatment machine) that the AQA platform requires.
    </p>
    <p>
        The Series Maker allows you to convert these files into fully defined DICOM series that can be analyzed on the
        AQA platform.
    </p>

    <h3>Using Series Maker</h3>

    <p>
        From the home page, click the <!--suppress HtmlUnknownTarget -->
        <a href="/SeriesMaker" target="_blank">Series Maker</a> link. This will show the
        upload page:
    </p>

    <p style="margin-top: 30px">
        <a href="Upload.png" style="border:1px gray;margin:10px;" target="_blank">
            <img src="Upload.png" style="margin:5px; border: 1px solid lightgray;width:600px;"
                 alt="Screen Shot of Upload Interface"/>
        </a>
    </p>

    <p>
        Three types of DICOM files are needed to construct a new series:
    </p>
    <ol>
        <li style="margin:15px;">
            <b>Source Image:</b>
            Uploaded by user, and provide the pixels for analysis. They can be any combination of dev and production
            images.
        </li>

        <li style="margin:15px;">
            <b>Plan:</b>
            Exactly one plan must be specified. This can be done either explicitly by uploading the plan with the
            images, or
            implicitly by uploading at least one production image that references a plan.
        </li>

        <li style="margin:15px;">
            <b>Template:</b>
            These are production images that provide the DICOM metadata required to fill in the information missing in
            dev images. They are either uploaded by the user, or, are automatically extracted from the AQA database from
            a previous analysis via their plan reference.
        </li>
    </ol>


    <p>
        From the home page, click the <!--suppress HtmlUnknownTarget --><a href="/SeriesMaker" target="_blank">Series
        Maker</a> link.
    </p>

    <p>
        <b>Note: </b>It is recommended that before making series, that at least one set of production images be
        delivered and analyzed. This provides a default set of template images for the subsequent dev images.
    </p>

    <h4>Step 1: Upload Image Files</h4>
    <p>
        Drag and drop the image files and optionally a plan file. Click 'Next' and a page similar to the one below will
        be shown:
    </p>

    <p style="margin-top: 30px">
        <a href="AfterNext.png" style="border:1px gray;margin:10px;" target="_blank">
            <img src="AfterNext.png" style="margin:5px; border: 1px solid lightgray;width:1000px;"
                 alt="Screen Shot of Interface"/>
        </a>
    </p>

    <h4>Step 3: Drag and Drop</h4>
    <p>
        Image files are listed on the left, grouped by series. Open slots for plan beams are on the right. Drag the
        desired image into the appropriate plan beam slot.
    </p>
    <ul>
        <li> It is not necessary to fill all slots.</li>
        <li> Images do not need to be slotted in chronological order.</li>
    </ul>

    <h4>Step 2: Set parameters</h4>

    <p>
        Set the machine to the one that the image files were delivered on. The machine does not need to match the plan's
        machine.
    </p>

    <p>
        The 'Download File' is the name that will be given to the downloaded zip file. If helpful, change it to
        something that describes the data set.
    </p>

    <p>
        Change the patient name and ID if appropriate. Often these reflect the machine name.
    </p>

    <h4>Step 4: Download</h4>
    <p>
        Clicking the 'Download' button will make the series and download it to your computer as a zip file.
    </p>

    <h4>Step 5: Run (Optional)</h4>
    <p>
        The zip file can be run on AQA directly (without extracting it). Click the <!--suppress HtmlUnknownTarget --><a
            href="/run/WebRunIndex">Run
        Procedure</a> link and then the appropriate procedure. You can then drag and drop the zip file into the web
        interface and click 'Run'.
    </p>


    <hr style="margin-top:100px;margin-bottom:20px;"/>
    <h3>Detailed Description of RTIMAGE List</h3>

    <p>
        Within each series, the images are sorted in the order they were acquired. Each item represents an image and has
        the following information:
    <ul>
        <li>
            The number of the image within the series (ordered by acquisition time).
        </li>
        <li>
            The beam name, or, for dev images, the gantry angle, collimator angle, and energy.
        </li>
        <li>
            The capture time since the start of the series. The first will always have the time '00:00'.
        </li>
        <li>
            A thumbnail image of the RTIMAGE. Hovering the mouse over this will display a full sized image. Each image
            is annotated with an MD5 hash of the bytes of the image bytes. This can be useful for determining if two
            images are the same or not.
        </li>
        <li>
            The name of the file (minus any '.dcm' extension). For screen space reasons, long file names will be
            abbreviated using only the last characters of the name. Hovering the mouse over the file name will display
            the full name.
        </li>
    </ul>

    <hr style="margin-top:100px;margin-bottom:20px;"/>
    <h3>List of DICOM Metadata</h3>

    <p>
        The new file is created by modifying a variety of attributes. In general:
    </p>
    <ul>
        <li>The image pixels and image properties (rows, resolution, scaling, etc.) are copied from the source image.
        </li>
        <li>Some UIDs (Unique IDs) are newly created, others are copied from the template files.</li>
        <li>Most dates and times are set to the <em>ContentDate</em> and <em>ContentTime</em> in the image file, some
            are from the template file.
        </li>
        <li>Some values are set by the user via the web interface (e.g. <em>PatientID</em>,
            <em>RadiationMachineName</em>).
        </li>
        <li>
            Beam defining attributes (e.g. KVP, GantryAngle) are copied from the template file. Several of these values
            are used by the AQA analysis to determine how to process the beam. Overriding them forces the software to
            treat them as it would the beam by that name.
        </li>
    </ul>


    <h3>Miscellaneous Attributes</h3>
    <p>
        The following attributes are set up with special processing.
    </p>

    <table class="table table-bordered" style="text-align:left;width: 100%;">
        <tr>
            <th>Hex Tag</th>
            <th>Attribute Name</th>
            <th>Value Setup</th>
        </tr>
        <tr>
            <td> 3002,0012</td>
            <td>RTImagePosition</td>
            <td> Calculated from values in the image <em> 3002,0011 </em>:<em>ImagePlanePixelSpacing</em> <em>
                0028,0010 </em>:<em>Rows</em> and <em> 0028,0011 </em>:<em>Columns</em></td>
        </tr>

        <tr>
            <td> 300c,0002</td>
            <td>ReferencedRTPlanSequence</td>
            <td>Constructed using specified plan</td>
        </tr>

        <tr>
            <td> 0008,0080</td>
            <td>InstitutionName</td>
            <td>Copied from image files not available for dev files</td>
        </tr>
    </table>

    <h3>Unique IDs</h3>
    <p>
        List of UIDs that are set up.
    </p>

    <table class="table table-bordered" style="text-align:left;width: 100%;">
        <tr>
            <th>Hex Tag</th>
            <th>Attribute Name</th>
            <th>Value Setup</th>
        </tr>
        <tr>
            <td> 0002,0003</td>
            <td>MediaStorageSOPInstanceUID</td>
            <td>Set to new unique ID</td>
        </tr>
        <tr>
            <td> 0008,0018</td>
            <td>SOPInstanceUID</td>
            <td> Set to same as <em>MediaStorageSOPInstanceUID</em></td>
        </tr>
        <tr>
            <td> 0020,000d</td>
            <td>StudyInstanceUID</td>
            <td>Copied from template file</td>
        </tr>
        <tr>
            <td> 0020,000e</td>
            <td>SeriesInstanceUID</td>
            <td> Set to new unique ID Same for each image in series</td>
        </tr>
        <tr>
            <td> 0020,0052</td>
            <td>FrameOfReferenceUID</td>
            <td>Set to new unique ID Different for each image</td>
        </tr>

    </table>

    <h3>Dates and Times</h3>
    <p>
        List how dates and times are set up. Note that in dev files, the only date/time value that are present are the
        <em>ContentDatea</em> and <em>ContentTime</em> values.
    </p>
    <table class="table table-bordered" style="text-align:left;width: 100%;">
        <tr>
            <th>Hex Tag</th>
            <th>Attribute Name</th>
            <th>Value Setup</th>
        </tr>
        <tr>
            <td> 0008,0020</td>
            <td>StudyDate</td>
            <td> Set to <em>StudyDate</em> of earliest production (non dev) image</td>
        </tr>
        <tr>
            <td> 0008,0030</td>
            <td>StudyTime</td>
            <td> Set to <em>StudyTime</em> of earliest production (non dev) image</td>
        </tr>
        <tr>
            <td> 0008,0021</td>
            <td>SeriesDate</td>
            <td><em>ContentDate</em> of first image beam</td>
        </tr>
        <tr>
            <td> 0008,0031</td>
            <td>SeriesTime</td>
            <td><em>ContentTime</em> of first image beam</td>
        </tr>
        <tr>
            <td> 0008,0022</td>
            <td>AcquisitionDate</td>
            <td> Set to image <em>ContentDate</em></td>
        </tr>
        <tr>
            <td> 0008,0032</td>
            <td>AcquisitionTime</td>
            <td>Set to image <em>ContentTime</em></td>
        </tr>
        <tr>
            <td> 0008,0012</td>
            <td>InstanceCreationDate</td>
            <td> set to same as <em>ContentDate</em></td>
        </tr>
        <tr>
            <td> 0008,0013</td>
            <td>InstanceCreationTime</td>
            <td>set to same as <em>ContentTime</em></td>
        </tr>

    </table>

    <h3>Values Set By User</h3>
    <p>
        These values are directly or indirectly controlled by the user via the web interface.
    </p>

    <table class="table table-bordered" style="text-align:left;width: 100%;">
        <tr>
            <th>Hex Tag</th>
            <th>Attribute Name</th>
            <th>Value Setup</th>
        </tr>

        <tr>
            <td> 0008,1010</td>
            <td>StationName</td>
            <td> Set to same as <em>RadiationMachineName</em></td>
        </tr>

        <tr>
            <td> 0010,0010</td>
            <td>PatientName</td>
            <td> Set by user Defaults to value found in uploaded RTIMAGE files If not defined there defaults to value in
                plan
            </td>
        </tr>

        <tr>
            <td> 0010,0020</td>
            <td>PatientID</td>
            <td>Set by user Defaults to value found in uploaded RTIMAGE files If not defined there defaults to value in
                plan
            </td>
        </tr>

        <tr>
            <td> 0018,1000</td>
            <td>DeviceSerialNumber</td>
            <td> Set by user when choosing machine</td>
        </tr>

        <tr>
            <td> 3002,0020</td>
            <td>RadiationMachineName</td>
            <td>Set by user when choosing machine</td>
        </tr>

    </table>


    <h3>Values Copied from Image</h3>
    <p>
        The following DICOM attributes are copied from the source image file to the new file.
    </p>
    <table class="table table-bordered" style="text-align:left;">
        <tr>
            <th>Hex Tag</th>
            <th>Attribute Name</th>
        </tr>
        <tr>
            <td>Hex Tag</td>
            <td>Name</td>
        </tr>
        <tr>
            <td> 0008,0023</td>
            <td>ContentDate</td>
        </tr>
        <tr>
            <td> 0008,0033</td>
            <td>ContentTime</td>
        </tr>
        <tr>
            <td> 0020,4000</td>
            <td>ImageComments</td>
        </tr>
        <tr>
            <td> 0028,0002</td>
            <td>SamplesPerPixel</td>
        </tr>
        <tr>
            <td> 0028,0004</td>
            <td>PhotometricInterpretation</td>
        </tr>
        <tr>
            <td> 0028,0010</td>
            <td>Rows</td>
        </tr>
        <tr>
            <td> 0028,0011</td>
            <td>Columns</td>
        </tr>
        <tr>
            <td> 0028,0100</td>
            <td>BitsAllocated</td>
        </tr>
        <tr>
            <td> 0028,0101</td>
            <td>BitsStored</td>
        </tr>
        <tr>
            <td> 0028,0102</td>
            <td>HighBit</td>
        </tr>
        <tr>
            <td> 0028,0103</td>
            <td>PixelRepresentation</td>
        </tr>
        <tr>
            <td> 0028,1050</td>
            <td>WindowCenter</td>
        </tr>
        <tr>
            <td> 0028,1051</td>
            <td>WindowWidth</td>
        </tr>
        <tr>
            <td> 0028,1052</td>
            <td>RescaleIntercept</td>
        </tr>
        <tr>
            <td> 0028,1053</td>
            <td>RescaleSlope</td>
        </tr>
        <tr>
            <td> 0028,1054</td>
            <td>RescaleType</td>
        </tr>
        <tr>
            <td> 3002,0002</td>
            <td>RTImageLabel</td>
        </tr>
        <tr>
            <td> 3002,0003</td>
            <td>RTImageName</td>
        </tr>
        <tr>
            <td> 3002,0004</td>
            <td>RTImageDescription</td>
        </tr>
        <tr>
            <td> 3002,000a</td>
            <td>ReportedValuesOrigin</td>
        </tr>
        <tr>
            <td> 3002,000c</td>
            <td>RTImagePlane</td>
        </tr>
        <tr>
            <td> 3002,000d</td>
            <td>XRayImageReceptorTranslation</td>
        </tr>
        <tr>
            <td> 3002,000e</td>
            <td>XRayImageReceptorAngle</td>
        </tr>
        <tr>
            <td> 3002,0011</td>
            <td>ImagePlanePixelSpacing</td>
        </tr>
        <tr>
            <td> 3002,0022</td>
            <td>RadiationMachineSAD</td>
        </tr>
        <tr>
            <td> 3002,0026</td>
            <td>RTImageSID</td>
        </tr>
        <tr>
            <td> 7fe0,0010</td>
            <td>PixelData</td>
        </tr>
    </table>

    <h3>Values from Template</h3>
    <p>
        The following DICOM attributes are copied from the template DICOM (the one delivered in production mode).
    </p>
    <table class="table table-bordered" style="text-align:left;">
        <tr>
            <th>Hex Tag</th>
            <th>Attribute Name</th>
        </tr>
        <tr>
            <td>3002,0029</td>
            <td>FractionNumber</td>
        </tr>
        <tr>
            <td>0008,1160</td>
            <td>ReferencedFrameNumber</td>
        </tr>
        <tr>
            <td>0018,0060</td>
            <td>KVP</td>
        </tr>
        <tr>
            <td>3002,0032</td>
            <td>MetersetExposure</td>
        </tr>
        <tr>
            <td>300A,00B6</td>
            <td>BeamLimitingDeviceSequence</td>
        </tr>
        <tr>
            <td>300A,00B8</td>
            <td>RTBeamLimitingDeviceType</td>
        </tr>
        <tr>
            <td>300A,00BC</td>
            <td>NumberOfLeafJawPairs</td>
        </tr>
        <tr>
            <td>300A,011C</td>
            <td>LeafJawPositions</td>
        </tr>
        <tr>
            <td>300A,00B8</td>
            <td>RTBeamLimitingDeviceType</td>
        </tr>
        <tr>
            <td>300A,00BC</td>
            <td>NumberOfLeafJawPairs</td>
        </tr>
        <tr>
            <td>300A,011C</td>
            <td>LeafJawPositions</td>
        </tr>
        <tr>
            <td>300A,00F0</td>
            <td>NumberOfBlocks</td>
        </tr>
        <tr>
            <td>300A,011E</td>
            <td>GantryAngle</td>
        </tr>
        <tr>
            <td>300A,0120</td>
            <td>BeamLimitingDeviceAngle</td>
        </tr>
        <tr>
            <td>300A,0122</td>
            <td>PatientSupportAngle</td>
        </tr>
        <tr>
            <td>300A,0128</td>
            <td>TableTopVerticalPosition</td>
        </tr>
        <tr>
            <td>300A,0129</td>
            <td>TableTopLongitudinalPosition</td>
        </tr>
        <tr>
            <td>300A,012A</td>
            <td>TableTopLateralPosition</td>
        </tr>
        <tr>
            <td>300A,00B3</td>
            <td>PrimaryDosimeterUnit</td>
        </tr>
        <tr>
            <td>300A,011E</td>
            <td>GantryAngle</td>
        </tr>
        <tr>
            <td>300A,0120</td>
            <td>BeamLimitingDeviceAngle</td>
        </tr>
        <tr>
            <td>300A,0122</td>
            <td>PatientSupportAngle</td>
        </tr>
        <tr>
            <td>300A,0128</td>
            <td>TableTopVerticalPosition</td>
        </tr>
        <tr>
            <td>300A,0129</td>
            <td>TableTopLongitudinalPosition</td>
        </tr>
        <tr>
            <td>300A,012A</td>
            <td>TableTopLateralPosition</td>
        </tr>
        <tr>
            <td>300A,012C</td>
            <td>IsocenterPosition</td>
        </tr>
        <tr>
            <td>300C,0006</td>
            <td>ReferencedBeamNumber</td>
        </tr>
        <tr>
            <td>300C,0022</td>
            <td>ReferencedFractionGroupNumber</td>
        </tr>
        <tr>
            <td>3273,0010</td>
            <td>VarianCreator3273</td>
        </tr>
        <tr>
            <td>3273,1000</td>
            <td>RTImageIsocenterPosition</td>
        </tr>
        <tr>
            <td>3273,1001</td>
            <td>RTImagePatientPosition</td>
        </tr>
    </table>


    <!-- ======================================= -->

    <!-- End of page spacer. -->
    <p style="margin:200px;">

    </p>


    <!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
    <!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->

</div>
